#!/usr/bin/env python
# -*- coding: utf-8 -*-
# diamond-patterns (cc) 2019 Ian Dennis Miller

import click
import pkg_resources
import os
import sys
import requests
sys.path.insert(0, '.')
from diamond_patterns import Pattern


@click.group()
@click.option('--pattern', help='name of pattern to apply.')
@click.pass_context
def cli(ctx, pattern):
    ctx.obj['pattern'] = pattern


@cli.command('scaffold', short_help='scaffold a folder with a pattern.')
@click.pass_context
def scaffold(ctx):
    from diamond_patterns.__meta__ import __version__
    print("Diamond-Patterns", __version__)
    pattern = ctx.obj['pattern']
    diamond_patterns.run_scaffold(pattern)


@cli.command('noprompt', short_help='non-interactive scaffold.')
@click.pass_context
def non_interactive(ctx):
    from diamond_patterns.__meta__ import __version__
    print("Diamond-Patterns", __version__)
    pattern = ctx.obj['pattern']
    diamond_patterns.run_scaffold(pattern, testing=True)


@cli.command('list', short_help='list available patterns.')
def list_patterns():
    from diamond_patterns.__meta__ import __version__
    print("Diamond-Patterns", __version__)

    print("Available patterns:\n")
    for pattern in pkg_resources.resource_listdir('diamond_patterns', 'patterns'):
        print("- {0}".format(pattern))
    print("")


@cli.command('version', short_help='show version')
def version():
    from diamond_patterns.__meta__ import __version__
    print(__version__)


@cli.command('update', short_help='update patterns')
def update():
    from diamond_patterns.__meta__ import __version__
    print("Diamond-Patterns", __version__)
    p = Pattern()
    p.download_manifest()


if __name__ == '__main__':
    cli(obj={})
