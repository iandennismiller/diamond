#!/bin/bash
# diamond-patterns 2016 Ian Dennis Miller
# http://github.com/iandennismiller/diamond-patterns

SKEL_TYPE=$1
DESTINATION=$2
DIAMOND_PATTERNS_PATH=~/.diamond-patterns
DIAMOND_SKELS_PATH=~/.diamond-patterns/skels

if [ -f ~/.diamond-patterns.conf  ]; then
    source ~/.diamond-patterns.conf
fi

function usage() {
cat <<-EOF
Diamond-Patterns - http://github.com/iandennismiller/diamond-patterns

Usage: diamond [pattern] [destination]

Options:

    -h, --help          output help information

Patterns:

    article             a LaTeX article
    analysis            an R project
    python              Python module for pypi
    website             a Jekyll website

EOF
}

function scaffold() {
    echo "create project type '${SKEL_TYPE}' in '${DESTINATION}'"

    DIAMOND_SKELS_PATH=$(python -c "\
import pkg_resources
import diamond_patterns
import os
filename = pkg_resources.resource_filename('diamond_patterns', 'skels')
pathname = os.path.dirname(os.path.abspath(diamond_patterns.__file__))
print(os.path.join(pathname, filename))
    ")

    mrbob -w "${DIAMOND_SKELS_PATH}/${SKEL_TYPE}" -O "${DESTINATION}"
    exit
}

# handle the case where there are not enough arguments

if test $# -lt 2; then
    usage
    exit
fi

# handle arguments

while test $# -ne 0; do
    arg=$1; shift
    case $arg in
        -h|--help) usage; exit ;;
        *) scaffold $SKEL_TYPE $DESTINATION; exit ;;
    esac
done
